<div class="import-ratings-wrapper" data-controller="import-ratings" data-import-ratings-case-id-value="<%= @case_id %>">
  <a href="#" class="<%= @icon_only ? 'action-icon' : '' %>" data-action="click->import-ratings#open" data-import-ratings-target="trigger" title="Import" aria-label="Import">
    <i class="bi bi-file-earmark-arrow-down" aria-hidden="true"></i>
    <% unless @icon_only %><span class="ms-1">Import</span><% end %>
  </a>

  <div class="modal fade" id="importRatingsModal" tabindex="-1" aria-labelledby="importRatingsModalLabel" aria-hidden="true" data-import-ratings-target="modal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="importRatingsModalLabel">Import into Case: <span class="modal-case"><%= @case_name %></span></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs mb-3" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="tab-ratings" data-bs-toggle="tab" data-bs-target="#panel-ratings" type="button" role="tab">Ratings</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tab-info-needs" data-bs-toggle="tab" data-bs-target="#panel-info-needs" type="button" role="tab">Information Needs</button>
            </li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane fade show active" id="panel-ratings" role="tabpanel">
              <p class="text-muted small">Import ratings from CSV, RRE (JSON), or LTR format. This can override existing ratings.</p>
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="import-clear-queries" data-import-ratings-target="clearQueries">
                <label class="form-check-label" for="import-clear-queries">Clear existing queries?</label>
              </div>
              <div class="mb-2">Format:</div>
              <div class="mb-2">
                <input type="radio" name="importFormat" id="fmt-csv" value="csv" class="form-check-input" data-import-ratings-target="formatRadio" data-action="change->import-ratings#formatChanged">
                <label class="form-check-label" for="fmt-csv">CSV</label>
                <span class="form-text d-block">Headers: <code>query,docid,rating</code>. Paste CSV below or choose file.</span>
              </div>
              <div class="mb-2">
                <input type="radio" name="importFormat" id="fmt-rre" value="rre" class="form-check-input" data-import-ratings-target="formatRadio" data-action="change->import-ratings#formatChanged">
                <label class="form-check-label" for="fmt-rre">RRE (Rated Ranking Evaluator) JSON</label>
              </div>
              <div class="mb-2">
                <input type="radio" name="importFormat" id="fmt-ltr" value="ltr" class="form-check-input" data-import-ratings-target="formatRadio" data-action="change->import-ratings#formatChanged">
                <label class="form-check-label" for="fmt-ltr">LTR (Learning to Rank) text</label>
              </div>
              <div class="mb-2 d-none" data-import-ratings-target="csvPane">
                <label class="form-label">CSV content</label>
                <textarea class="form-control font-monospace" rows="6" data-import-ratings-target="csvText" placeholder="query,docid,rating&#10;star wars,3574597,3"></textarea>
              </div>
              <div class="mb-2 d-none" data-import-ratings-target="rrePane">
                <label class="form-label">RRE JSON file</label>
                <input type="file" class="form-control" accept="application/json" data-import-ratings-target="rreFile" data-action="change->import-ratings#rreFilePicked">
              </div>
              <div class="mb-2 d-none" data-import-ratings-target="ltrPane">
                <label class="form-label">LTR text file</label>
                <input type="file" class="form-control" accept="text/plain,.txt" data-import-ratings-target="ltrFile" data-action="change->import-ratings#ltrFilePicked">
              </div>
              <div class="alert alert-danger d-none" data-import-ratings-target="ratingsError" role="alert"></div>
            </div>
            <div class="tab-pane fade" id="panel-info-needs" role="tabpanel">
              <p class="text-muted small">Import information needs from a CSV with <code>query,information_need</code>. Export a template from Export first.</p>
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="import-create-queries" data-import-ratings-target="createQueries">
                <label class="form-check-label" for="import-create-queries">Create missing queries?</label>
              </div>
              <label class="form-label">CSV content (query,information_need)</label>
              <textarea class="form-control font-monospace mb-2" rows="6" data-import-ratings-target="infoNeedsText" placeholder="query,information_need&#10;star wars,&quot;The original movie&quot;"></textarea>
              <div class="alert alert-danger d-none" data-import-ratings-target="infoNeedsError" role="alert"></div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-action="click->import-ratings#submit" data-import-ratings-target="submitBtn">Import</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
