<%# Query list for case/try workspace. Each row: query text, score, Move/Options/Explain. %>
<%# Wrapped in Turbo Frame so the region can be updated via Turbo Streams (e.g. add/remove/reorder queries). %>
<%= helpers.turbo_frame_tag "query_list_#{@case_id}" do %>
<div class="query-list border rounded p-2 bg-light" data-controller="query-list" data-query-list-sortable-value="<%= @sortable %>" data-query-list-case-id-value="<%= @case_id %>">
  <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
    <% if add_query? %>
      <div class="flex-grow-1"><%= add_query %></div>
    <% end %>
    <h3 class="h6 mb-0">Queries</h3>
    <span class="badge bg-secondary" data-query-list-target="count"><%= @queries.size %></span>
    <% unless @queries.empty? %>
      <div class="btn-group btn-group-sm ms-auto">
        <button type="button" class="btn btn-outline-secondary" data-action="click->query-list#expandAll" title="Expand all queries">
          <i class="bi bi-chevron-expand" aria-hidden="true"></i>
        </button>
        <button type="button" class="btn btn-outline-secondary" data-action="click->query-list#collapseAll" title="Collapse all queries">
          <i class="bi bi-chevron-contract" aria-hidden="true"></i>
        </button>
      </div>
    <% end %>
  </div>
  <% unless @queries.empty? %>
    <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
      <input type="text" class="form-control form-control-sm max-w-180" placeholder="Filter queries…"
             data-query-list-target="filterInput" data-action="input->query-list#filter">
      <div class="form-check form-check-inline mb-0">
        <input type="checkbox" class="form-check-input" id="query-list-rated-only" data-query-list-target="ratedToggle" data-action="change->query-list#filter">
        <label class="form-check-label small" for="query-list-rated-only">Rated only</label>
      </div>
      <select class="form-select form-select-sm max-w-140" data-query-list-target="sortSelect" data-action="change->query-list#sort">
        <option value="default">Default order</option>
        <option value="name">Name A-Z</option>
        <option value="name_desc">Name Z-A</option>
        <option value="score_asc">Score ↑</option>
        <option value="score_desc">Score ↓</option>
        <option value="modified">Modified ↑</option>
        <option value="modified_desc">Modified ↓</option>
        <option value="error">Errors first</option>
      </select>
    </div>
  <% end %>
  <ul class="list-group list-group-flush list-group-numbered" id="query_list_items" data-query-list-target="list">
  <% if @queries.empty? %>
    <li id="query_list_empty_placeholder" class="list-group-item text-muted small border-0">
      <% if empty_state? %>
        <%= empty_state %>
      <% else %>
        No queries yet. Add one above.
      <% end %>
    </li>
  <% else %>
    <% @queries.each do |query| %>
        <%= render "core/queries/query_row",
                   query: query,
                   case_id: @case_id,
                   try_number: @try_number,
                   sortable: @sortable,
                   scorer_scale_max: @scorer_scale_max,
                   scorer_scale: @scorer_scale,
                   query_score: score_for(query),
                   options_json: options_for_query(query),
                   other_cases: @other_cases,
                   unrated: unrated?(query) %>
      <% end %>
  <% end %>
  </ul>
  <div data-query-list-target="pagination"></div>
</div>
<% end %>
