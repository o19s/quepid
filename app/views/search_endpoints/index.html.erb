<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1>Search Endpoints</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group me-2">
      <%= link_to 'New Search Endpoint', new_search_endpoint_path, class: "btn btn-sm btn-outline-secondary" %>
      <%= link_to new_mapper_wizard_path, class: "btn btn-sm btn-outline-info" do %>
        <i class="bi bi-stars"></i> New SearchAPI with Mapper Wizard
      <% end %>
    </div>    
  </div>
</div>

Search Endpoints represents a search engine (or API!) that is receiving queries and responding with results.


<p id="notice"><%= notice %></p>

<% if @search_endpoints.empty? %>
  Create your first book by clicking on the New Search Endpoint button above.
  <br>
<% end %>

  <div class="card h-100">
    <div class="card-header">
      <%= form_tag(search_endpoints_path, { method: :get }) do %>
        <div class="mb-0 d-flex flex-wrap align-items-center gap-3 fs-6">

          <!-- Search input with fixed width -->
          <div class="input-group" style="max-width: 280px;">
            <%= text_field_tag :q, params[:q],
                class: 'form-control form-control-sm',
                placeholder: 'Filter by name or url',
                id: 'q'
            %>
            <%= button_tag type: 'submit', class: 'btn btn-sm btn-outline-secondary' do %>
              <i class="bi bi-search-heart"></i>
            <% end %>
          </div>

          <!-- Checkboxes -->
          <div class="d-flex align-items-center gap-3">
            <div class="form-check form-check-inline mb-0">
              <%= check_box_tag :owned,
                  true,
                  params[:owned].present?,
                  class: 'form-check-input',
                  id: 'owned',
                  onchange: 'this.form.submit()'
              %>
              <label class="form-check-label" for="owned">Mine</label>
            </div>

            <div class="form-check form-check-inline mb-0">
              <%= check_box_tag :archived,
                  true,
                  params[:archived].present?,
                  class: 'form-check-input',
                  id: 'archived',
                  onchange: 'this.form.submit()'
              %>
              <label class="form-check-label" for="archived">Archived</label>
            </div>
          </div>

          <div class="col-auto d-flex align-items-center">
            <label for="team_id" class="me-2 mb-0">Team:</label>
            <%= select_tag :team_id,
                options_for_select(
                  [['All', '']] + @current_user.teams.map { |j| [j.name, j.id] },
                  params[:team_id]
                ),
                class: 'form-select form-select-sm',
                style: 'width: auto; min-width: 140px;',
                id: 'team_id',
                onchange: 'this.form.submit()'
            %>
          </div>

        </div>
      <% end %>
    </div>
    
    <div class="card-body">
      <table class="table table-hover table-sm">
        <thead>
          <tr>
            <th>Name</th>
            <th>Search Engine</th>
            <th>Endpoint Url</th>
            <th class="text-end"></th>
          </tr>
        </thead>
    
        <tbody>      
          <% @search_endpoints.each do |search_endpoint| %>
            <tr>
              <td><%= link_to search_endpoint.fullname, search_endpoint_path(search_endpoint) %></td>
              <td>
                <% if search_endpoint.search_engine %>
                  <%= image_tag "#{search_endpoint.search_engine}-icon.png", size:'32x32', class:'rounded-circle' %> 
                <% end %>
                <%= search_endpoint.search_engine %>
              </td>
              <td><%= search_endpoint.endpoint_url %> </td>
              <td class="text-end">
                <%= button_tag type: 'button',
                               class: 'btn btn-link p-0',
                               title: 'Share',
                               'aria-label': 'Share',
                               data: {
                                 controller: 'share-search-endpoint',
                                 action: 'click->share-search-endpoint#open',
                                 bs_toggle: 'modal',
                                 bs_target: '#shareSearchEndpointModal',
                                 share_search_endpoint_id_value: search_endpoint.id,
                                 share_search_endpoint_name_value: search_endpoint.fullname,
                                 share_search_endpoint_all_teams_json: @current_user.teams.select(:id, :name).order(:name).to_json,
                                 share_search_endpoint_shared_teams_json: search_endpoint.teams.select(:id, :name).to_json
                               } do %>
                  <i class="bi bi-share" aria-hidden="true"></i>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="card-footer d-flex justify-content-center">
      <%== @pagy.series_nav(:bootstrap) %>
    </div>
  </div>

<%= render 'shared/share_search_endpoint_modal' %>
