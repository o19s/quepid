<div class="modal-header">
  <button type="button" class="close btn-core-close" ng-click="ctrl.cancel()" aria-label="Close"></button>
  <h3 class="modal-title">Compare Your Search Results</h3>
</div>
<div class="modal-body">
  <p>Select 1-3 snapshots to compare against your current search results</p>
  
  <form action="">
    <div class="form-group">
      <h4>Select Snapshots:</h4>
      <div class="snapshot-selection-container" style="margin-top: 10px;">
        <div ng-repeat="selection in ctrl.selections track by $index" class="snapshot-selection-row" style="margin-bottom: 10px; display: flex; align-items: center;">
          <label style="margin-right: 10px; min-width: 100px;">Snapshot {{$index + 1}}:</label>
          <select
            ng-model="ctrl.selections[$index]"
            ng-options="snapshot.id as snapshot.name() for (id, snapshot) in ctrl.snapshots"
            ng-change="ctrl.validateSelections()"
            style="margin-right: 10px; min-width: 200px;"
          >
            <option value="">-- Select Snapshot --</option>
          </select>
          
          <button
            type="button"
            class="btn btn-xs btn-danger"
            ng-show="ctrl.selections[$index] && ctrl.selections.length > 1"
            ng-click="ctrl.removeSelection($index)"
            title="Remove this snapshot"
          >
            <i class='bi bi-x-lg'></i>
          </button>
          
          <button
            type="button"
            class="btn btn-xs btn-danger"
            ng-show="ctrl.selections[$index]"
            ng-click="ctrl.toggleDel(ctrl.selections[$index])"
            title="Delete this snapshot"
            style="margin-left: 5px;"
          >
            <i class='bi bi-trash'></i>
          </button>
        </div>
        
        <button
          type="button"
          class="btn btn-xs btn-success"
          ng-show="ctrl.canAddMore()"
          ng-click="ctrl.addSelection()"
          title="Add another snapshot"
        >
          <i class='bi bi-plus'></i> Add Snapshot
        </button>
        
        <div class="alert alert-warning" ng-show="ctrl.hasDuplicateSelections()">
          <strong>Warning:</strong> You have selected the same snapshot multiple times. Each snapshot should be unique.
        </div>
        
        <div class="alert alert-warning" role="alert" ng-if="ctrl.hasProcessingSnapshots()">
          One or more selected snapshots are currently being processed in the background. You should wait until they complete.
        </div>

        <div class="alert alert-warning" ng-show="ctrl.delStarted()">
          Are you sure you want to delete this snapshot?
          <a ng-click="ctrl.delConfirm()">yes</a> /
          <a ng-click="ctrl.toggleDel(null)">no</a>
        </div>
      </div>
    </div>

    <div class="form-group">
      <input type="checkbox" id="disable" ng-model="ctrl.disabled">
      <label for="disable">Disable all comparisons</label>
    </div>
  </form>
  
  <div ng-show="ctrl.getValidSelections().length > 0" class="selected-snapshots-preview">
    <h4>Selected Snapshots for Comparison:</h4>
    <ul>
      <li ng-repeat="snapshotId in ctrl.getValidSelections()">
        <strong>{{ctrl.getSnapshotName(snapshotId)}}</strong>
      </li>
    </ul>
  </div>
</div>

<div class="modal-footer">
  <button
    class="btn btn-default"
    ng-disabled="ctrl.inProgress || ctrl.nothingSelected()"
    ng-click="ctrl.ok()"
  >
    Update Comparison Settings
  </button>
  <button
    class="btn btn-default"
    ng-disabled="ctrl.inProgress"
    ng-click="ctrl.cancel()"
  >
    Cancel
  </button>

  <div ng-show="ctrl.inProgress">
    Fetching snapshot data, this may take a moment depending on the number of queries and snapshots...
  </div>
</div>

<style>
.snapshot-selection-container {
  border: 1px solid #ddd;
  padding: 15px;
  border-radius: 5px;
  background-color: #f9f9f9;
}

.snapshot-selection-row {
  padding: 5px 0;
}

.selected-snapshots-preview {
  margin-top: 20px;
  padding: 10px;
  background-color: #e8f4fd;
  border-radius: 5px;
}

.selected-snapshots-preview ul {
  margin-bottom: 0;
}
</style>