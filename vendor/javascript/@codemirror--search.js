// @codemirror/search@6.6.0 downloaded from https://ga.jspm.io/npm:@codemirror/search@6.6.0/dist/index.js

import{showDialog as e,EditorView as t,ViewPlugin as r,Decoration as i,showPanel as s,getPanel as n,runScopeHandlers as l}from"@codemirror/view";import{codePointAt as o,fromCodePoint as a,codePointSize as c,EditorSelection as h,Facet as u,combineConfig as f,CharCategory as d,StateField as m,Prec as p,EditorState as g,findClusterBreak as v,StateEffect as x,RangeSetBuilder as y}from"@codemirror/state";import w from"crelt";const S=typeof String.prototype.normalize=="function"?e=>e.normalize("NFKD"):e=>e;class SearchCursor{constructor(e,t,r=0,i=e.length,s,n){this.test=n;this.value={from:0,to:0};this.done=false;this.matches=[];this.buffer="";this.bufferPos=0;this.iter=e.iterRange(r,i);this.bufferStart=r;this.normalize=s?e=>s(S(e)):S;this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){this.bufferStart+=this.buffer.length;this.iter.next();if(this.iter.done)return-1;this.bufferPos=0;this.buffer=this.iter.value}return o(this.buffer,this.bufferPos)}next(){while(this.matches.length)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0){this.done=true;return this}let t=a(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=c(e);let i=this.normalize(t);if(i.length)for(let e=0,s=r;;e++){let n=i.charCodeAt(e);let l=this.match(n,s,this.bufferPos+this.bufferStart);if(e==i.length-1){if(l){this.value=l;return this}break}s==r&&e<t.length&&t.charCodeAt(e)==n&&s++}}}match(e,t,r){let i=null;for(let t=0;t<this.matches.length;t+=2){let s=this.matches[t],n=false;if(this.query.charCodeAt(s)==e)if(s==this.query.length-1)i={from:this.matches[t+1],to:r};else{this.matches[t]++;n=true}if(!n){this.matches.splice(t,2);t-=2}}this.query.charCodeAt(0)==e&&(this.query.length==1?i={from:t,to:r}:this.matches.push(1,t));i&&this.test&&!this.test(i.from,i.to,this.buffer,this.bufferStart)&&(i=null);return i}}typeof Symbol!="undefined"&&(SearchCursor.prototype[Symbol.iterator]=function(){return this});const b={from:-1,to:-1,match:/.*/.exec("")};const M="gm"+(/x/.unicode==null?"":"u");class RegExpCursor{constructor(e,t,r,i=0,s=e.length){this.text=e;this.to=s;this.curLine="";this.done=false;this.value=b;if(/\\[sWDnr]|\n|\r|\[\^/.test(t))return new MultilineRegExpCursor(e,t,r,i,s);this.re=new RegExp(t,M+((r===null||r===void 0?void 0:r.ignoreCase)?"i":""));this.test=r===null||r===void 0?void 0:r.test;this.iter=e.iter();let n=e.lineAt(i);this.curLineStart=n.from;this.matchPos=q(e,i);this.getLine(this.curLineStart)}getLine(e){this.iter.next(e);if(this.iter.lineBreak)this.curLine="";else{this.curLine=this.iter.value;this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart));this.iter.next()}}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1;this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let r=this.curLineStart+t.index,i=r+t[0].length;this.matchPos=q(this.text,i+(r==i?1:0));r==this.curLineStart+this.curLine.length&&this.nextLine();if((r<i||r>this.value.to)&&(!this.test||this.test(r,i,t))){this.value={from:r,to:i,match:t};return this}e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to)){this.done=true;return this}this.nextLine();e=0}}}}const k=new WeakMap;class FlattenedDoc{constructor(e,t){this.from=e;this.text=t}get to(){return this.from+this.text.length}static get(e,t,r){let i=k.get(e);if(!i||i.from>=r||i.to<=t){let i=new FlattenedDoc(t,e.sliceString(t,r));k.set(e,i);return i}if(i.from==t&&i.to==r)return i;let{text:s,from:n}=i;if(n>t){s=e.sliceString(t,n)+s;n=t}i.to<r&&(s+=e.sliceString(i.to,r));k.set(e,new FlattenedDoc(n,s));return new FlattenedDoc(t,s.slice(t-n,r-n))}}class MultilineRegExpCursor{constructor(e,t,r,i,s){this.text=e;this.to=s;this.done=false;this.value=b;this.matchPos=q(e,i);this.re=new RegExp(t,M+((r===null||r===void 0?void 0:r.ignoreCase)?"i":""));this.test=r===null||r===void 0?void 0:r.test;this.flat=FlattenedDoc.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from;let t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e){this.re.lastIndex=e+1;t=this.re.exec(this.flat.text)}if(t){let e=this.flat.from+t.index,r=e+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(e,r,t))){this.value={from:e,to:r,match:t};this.matchPos=q(this.text,r+(e==r?1:0));return this}}if(this.flat.to==this.to){this.done=true;return this}this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol!="undefined"&&(RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this});function C(e){try{new RegExp(e,M);return true}catch(e){return false}}function q(e,t){if(t>=e.length)return t;let r,i=e.lineAt(t);while(t<i.to&&(r=i.text.charCodeAt(t-i.from))>=56320&&r<57344)t++;return t}const L=r=>{let{state:i}=r;let s=String(i.doc.lineAt(r.state.selection.main.head).number);let{close:n,result:l}=e(r,{label:i.phrase("Go to line"),input:{type:"text",name:"line",value:s},focus:true,submitLabel:i.phrase("go")});l.then((e=>{let s=e&&/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.elements.line.value);if(!s){r.dispatch({effects:n});return}let l=i.doc.lineAt(i.selection.main.head);let[,o,a,c,u]=s;let f=c?+c.slice(1):0;let d=a?+a:l.number;if(a&&u){let e=d/100;o&&(e=e*(o=="-"?-1:1)+l.number/i.doc.lines);d=Math.round(i.doc.lines*e)}else a&&o&&(d=d*(o=="-"?-1:1)+l.number);let m=i.doc.line(Math.max(1,Math.min(i.doc.lines,d)));let p=h.cursor(m.from+Math.max(0,Math.min(f,m.length)));r.dispatch({effects:[n,t.scrollIntoView(p.from,{y:"center"})],selection:p})}));return true};const F={highlightWordAroundCursor:false,minSelectionLength:1,maxMatches:100,wholeWords:false};const W=u.define({combine(e){return f(e,F,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function D(e){let t=[Q,I];e&&t.push(W.of(e));return t}const R=i.mark({class:"cm-selectionMatch"});const A=i.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function E(e,t,r,i){return(r==0||e(t.sliceDoc(r-1,r))!=d.Word)&&(i==t.doc.length||e(t.sliceDoc(i,i+1))!=d.Word)}function P(e,t,r,i){return e(t.sliceDoc(r,r+1))==d.Word&&e(t.sliceDoc(i-1,i))==d.Word}const I=r.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(W);let{state:r}=e,s=r.selection;if(s.ranges.length>1)return i.none;let n,l=s.main,o=null;if(l.empty){if(!t.highlightWordAroundCursor)return i.none;let e=r.wordAt(l.head);if(!e)return i.none;o=r.charCategorizer(l.head);n=r.sliceDoc(e.from,e.to)}else{let e=l.to-l.from;if(e<t.minSelectionLength||e>200)return i.none;if(t.wholeWords){n=r.sliceDoc(l.from,l.to);o=r.charCategorizer(l.head);if(!(E(o,r,l.from,l.to)&&P(o,r,l.from,l.to)))return i.none}else{n=r.sliceDoc(l.from,l.to);if(!n)return i.none}}let a=[];for(let s of e.visibleRanges){let e=new SearchCursor(r.doc,n,s.from,s.to);while(!e.next().done){let{from:s,to:n}=e.value;if(!o||E(o,r,s,n)){l.empty&&s<=l.from&&n>=l.to?a.push(A.range(s,n)):(s>=l.to||n<=l.from)&&a.push(R.range(s,n));if(a.length>t.maxMatches)return i.none}}}return i.set(a)}},{decorations:e=>e.decorations});const Q=t.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});const $=({state:e,dispatch:t})=>{let{selection:r}=e;let i=h.create(r.ranges.map((t=>e.wordAt(t.head)||h.cursor(t.head))),r.mainIndex);if(i.eq(r))return false;t(e.update({selection:i}));return true};function z(e,t){let{main:r,ranges:i}=e.selection;let s=e.wordAt(r.head),n=s&&s.from==r.from&&s.to==r.to;for(let r=false,s=new SearchCursor(e.doc,t,i[i.length-1].to);;){s.next();if(!s.done){if(r&&i.some((e=>e.from==s.value.from)))continue;if(n){let t=e.wordAt(s.value.from);if(!t||t.from!=s.value.from||t.to!=s.value.to)continue}return s.value}if(r)return null;s=new SearchCursor(e.doc,t,0,Math.max(0,i[i.length-1].from-1));r=true}}const T=({state:e,dispatch:r})=>{let{ranges:i}=e.selection;if(i.some((e=>e.from===e.to)))return $({state:e,dispatch:r});let s=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some((t=>e.sliceDoc(t.from,t.to)!=s)))return false;let n=z(e,s);if(!n)return false;r(e.update({selection:e.selection.addRange(h.range(n.from,n.to),false),effects:t.scrollIntoView(n.to)}));return true};const O=u.define({combine(e){return f(e,{top:false,caseSensitive:false,literal:false,regexp:false,wholeWord:false,createPanel:e=>new SearchPanel(e),scrollToMatch:e=>t.scrollIntoView(e)})}});function V(e){return e?[O.of(e),Me]:Me}class SearchQuery{constructor(e){this.search=e.search;this.caseSensitive=!!e.caseSensitive;this.literal=!!e.literal;this.regexp=!!e.regexp;this.replace=e.replace||"";this.valid=!!this.search&&(!this.regexp||C(this.search));this.unquoted=this.unquote(this.search);this.wholeWord=!!e.wholeWord;this.test=e.test}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,((e,t)=>t=="n"?"\n":t=="r"?"\r":t=="t"?"\t":"\\"))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord&&this.test==e.test}create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}getCursor(e,t=0,r){let i=e.doc?e:g.create({doc:e});r==null&&(r=i.doc.length);return this.regexp?j(this,i,t,r):B(this,i,t,r)}}class QueryType{constructor(e){this.spec=e}}function K(e,t,r){return(i,s,n,l)=>{if(r&&!r(i,s,n,l))return false;let o=i>=l&&s<=l+n.length?n.slice(i-l,s-l):t.doc.sliceString(i,s);return e(o,t,i,s)}}function B(e,t,r,i){let s;e.wholeWord&&(s=G(t.doc,t.charCategorizer(t.selection.main.head)));e.test&&(s=K(e.test,t,s));return new SearchCursor(t.doc,e.unquoted,r,i,e.caseSensitive?void 0:e=>e.toLowerCase(),s)}function G(e,t){return(r,i,s,n)=>{if(n>r||n+s.length<i){n=Math.max(0,r-2);s=e.sliceString(n,Math.min(e.length,i+2))}return(t(H(s,r-n))!=d.Word||t(J(s,r-n))!=d.Word)&&(t(J(s,i-n))!=d.Word||t(H(s,i-n))!=d.Word)}}class StringQuery extends QueryType{constructor(e){super(e)}nextMatch(e,t,r){let i=B(this.spec,e,r,e.doc.length).nextOverlapping();if(i.done){let r=Math.min(e.doc.length,t+this.spec.unquoted.length);i=B(this.spec,e,0,r).nextOverlapping()}return i.done||i.value.from==t&&i.value.to==r?null:i.value}prevMatchInRange(e,t,r){for(let i=r;;){let r=Math.max(t,i-1e4-this.spec.unquoted.length);let s=B(this.spec,e,r,i),n=null;while(!s.nextOverlapping().done)n=s.value;if(n)return n;if(r==t)return null;i-=1e4}}prevMatch(e,t,r){let i=this.prevMatchInRange(e,0,t);i||(i=this.prevMatchInRange(e,Math.max(0,r-this.spec.unquoted.length),e.doc.length));return!i||i.from==t&&i.to==r?null:i}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let r=B(this.spec,e,0,e.doc.length),i=[];while(!r.next().done){if(i.length>=t)return null;i.push(r.value)}return i}highlight(e,t,r,i){let s=B(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));while(!s.next().done)i(s.value.from,s.value.to)}}function N(e,t,r){return(i,s,n)=>(!r||r(i,s,n))&&e(n[0],t,i,s)}function j(e,t,r,i){let s;e.wholeWord&&(s=U(t.charCategorizer(t.selection.main.head)));e.test&&(s=N(e.test,t,s));return new RegExpCursor(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:s},r,i)}function H(e,t){return e.slice(v(e,t,false),t)}function J(e,t){return e.slice(t,v(e,t))}function U(e){return(t,r,i)=>!i[0].length||(e(H(i.input,i.index))!=d.Word||e(J(i.input,i.index))!=d.Word)&&(e(J(i.input,i.index+i[0].length))!=d.Word||e(H(i.input,i.index+i[0].length))!=d.Word)}class RegExpQuery extends QueryType{nextMatch(e,t,r){let i=j(this.spec,e,r,e.doc.length).next();i.done&&(i=j(this.spec,e,0,t).next());return i.done?null:i.value}prevMatchInRange(e,t,r){for(let i=1;;i++){let s=Math.max(t,r-i*1e4);let n=j(this.spec,e,s,r),l=null;while(!n.next().done)l=n.value;if(l&&(s==t||l.from>s+10))return l;if(s==t)return null}}prevMatch(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,((t,r)=>{if(r=="&")return e.match[0];if(r=="$")return"$";for(let t=r.length;t>0;t--){let i=+r.slice(0,t);if(i>0&&i<e.match.length)return e.match[i]+r.slice(t)}return t}))}matchAll(e,t){let r=j(this.spec,e,0,e.doc.length),i=[];while(!r.next().done){if(i.length>=t)return null;i.push(r.value)}return i}highlight(e,t,r,i){let s=j(this.spec,e,Math.max(0,t-250),Math.min(r+250,e.doc.length));while(!s.next().done)i(s.value.from,s.value.to)}}const X=x.define();const Y=x.define();const Z=m.define({create(e){return new SearchState(fe(e).create(),null)},update(e,t){for(let r of t.effects)r.is(X)?e=new SearchState(r.value.create(),e.panel):r.is(Y)&&(e=new SearchState(e.query,r.value?ue:null));return e},provide:e=>s.from(e,(e=>e.panel))});function _(e){let t=e.field(Z,false);return t?t.query.spec:fe(e)}function ee(e){var t;return((t=e.field(Z,false))===null||t===void 0?void 0:t.panel)!=null}class SearchState{constructor(e,t){this.query=e;this.panel=t}}const te=i.mark({class:"cm-searchMatch"}),re=i.mark({class:"cm-searchMatch cm-searchMatch-selected"});const ie=r.fromClass(class{constructor(e){this.view=e;this.decorations=this.highlight(e.state.field(Z))}update(e){let t=e.state.field(Z);(t!=e.startState.field(Z)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return i.none;let{view:r}=this;let s=new y;for(let t=0,i=r.visibleRanges,n=i.length;t<n;t++){let{from:l,to:o}=i[t];while(t<n-1&&o>i[t+1].from-500)o=i[++t].to;e.highlight(r.state,l,o,((e,t)=>{let i=r.state.selection.ranges.some((r=>r.from==e&&r.to==t));s.add(e,t,i?re:te)}))}return s.finish()}},{decorations:e=>e.decorations});function se(e){return t=>{let r=t.state.field(Z,false);return r&&r.query.spec.valid?e(t,r):pe(t)}}const ne=se(((e,{query:t})=>{let{to:r}=e.state.selection.main;let i=t.nextMatch(e.state,r,r);if(!i)return false;let s=h.single(i.from,i.to);let n=e.state.facet(O);e.dispatch({selection:s,effects:[Se(e,i),n.scrollToMatch(s.main,e)],userEvent:"select.search"});me(e);return true}));const le=se(((e,{query:t})=>{let{state:r}=e,{from:i}=r.selection.main;let s=t.prevMatch(r,i,i);if(!s)return false;let n=h.single(s.from,s.to);let l=e.state.facet(O);e.dispatch({selection:n,effects:[Se(e,s),l.scrollToMatch(n.main,e)],userEvent:"select.search"});me(e);return true}));const oe=se(((e,{query:t})=>{let r=t.matchAll(e.state,1e3);if(!r||!r.length)return false;e.dispatch({selection:h.create(r.map((e=>h.range(e.from,e.to)))),userEvent:"select.search.matches"});return true}));const ae=({state:e,dispatch:t})=>{let r=e.selection;if(r.ranges.length>1||r.main.empty)return false;let{from:i,to:s}=r.main;let n=[],l=0;for(let t=new SearchCursor(e.doc,e.sliceDoc(i,s));!t.next().done;){if(n.length>1e3)return false;t.value.from==i&&(l=n.length);n.push(h.range(t.value.from,t.value.to))}t(e.update({selection:h.create(n,l),userEvent:"select.search.matches"}));return true};const ce=se(((e,{query:r})=>{let{state:i}=e,{from:s,to:n}=i.selection.main;if(i.readOnly)return false;let l=r.nextMatch(i,s,s);if(!l)return false;let o=l;let a,c,u=[];let f=[];if(o.from==s&&o.to==n){c=i.toText(r.getReplacement(o));u.push({from:o.from,to:o.to,insert:c});o=r.nextMatch(i,o.from,o.to);f.push(t.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(s).number)+"."))}let d=e.state.changes(u);if(o){a=h.single(o.from,o.to).map(d);f.push(Se(e,o));f.push(i.facet(O).scrollToMatch(a.main,e))}e.dispatch({changes:d,selection:a,effects:f,userEvent:"input.replace"});return true}));const he=se(((e,{query:r})=>{if(e.state.readOnly)return false;let i=r.matchAll(e.state,1e9).map((e=>{let{from:t,to:i}=e;return{from:t,to:i,insert:r.getReplacement(e)}}));if(!i.length)return false;let s=e.state.phrase("replaced $ matches",i.length)+".";e.dispatch({changes:i,effects:t.announce.of(s),userEvent:"input.replace.all"});return true}));function ue(e){return e.state.facet(O).createPanel(e)}function fe(e,t){var r,i,s,n,l;let o=e.selection.main;let a=o.empty||o.to>o.from+100?"":e.sliceDoc(o.from,o.to);if(t&&!a)return t;let c=e.facet(O);return new SearchQuery({search:((r=t===null||t===void 0?void 0:t.literal)!==null&&r!==void 0?r:c.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(i=t===null||t===void 0?void 0:t.caseSensitive)!==null&&i!==void 0?i:c.caseSensitive,literal:(s=t===null||t===void 0?void 0:t.literal)!==null&&s!==void 0?s:c.literal,regexp:(n=t===null||t===void 0?void 0:t.regexp)!==null&&n!==void 0?n:c.regexp,wholeWord:(l=t===null||t===void 0?void 0:t.wholeWord)!==null&&l!==void 0?l:c.wholeWord})}function de(e){let t=n(e,ue);return t&&t.dom.querySelector("[main-field]")}function me(e){let t=de(e);t&&t==e.root.activeElement&&t.select()}const pe=e=>{let t=e.state.field(Z,false);if(t&&t.panel){let r=de(e);if(r&&r!=e.root.activeElement){let i=fe(e.state,t.query.spec);i.valid&&e.dispatch({effects:X.of(i)});r.focus();r.select()}}else e.dispatch({effects:[Y.of(true),t?X.of(fe(e.state,t.query.spec)):x.appendConfig.of(Me)]});return true};const ge=e=>{let t=e.state.field(Z,false);if(!t||!t.panel)return false;let r=n(e,ue);r&&r.dom.contains(e.root.activeElement)&&e.focus();e.dispatch({effects:Y.of(false)});return true};const ve=[{key:"Mod-f",run:pe,scope:"editor search-panel"},{key:"F3",run:ne,shift:le,scope:"editor search-panel",preventDefault:true},{key:"Mod-g",run:ne,shift:le,scope:"editor search-panel",preventDefault:true},{key:"Escape",run:ge,scope:"editor search-panel"},{key:"Mod-Shift-l",run:ae},{key:"Mod-Alt-g",run:L},{key:"Mod-d",run:T,preventDefault:true}];class SearchPanel{constructor(e){this.view=e;let t=this.query=e.state.field(Z).query.spec;this.commit=this.commit.bind(this);this.searchField=w("input",{value:t.search,placeholder:xe(e,"Find"),"aria-label":xe(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit});this.replaceField=w("input",{value:t.replace,placeholder:xe(e,"Replace"),"aria-label":xe(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit});this.caseField=w("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit});this.reField=w("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit});this.wordField=w("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function r(e,t,r){return w("button",{class:"cm-button",name:e,onclick:t,type:"button"},r)}this.dom=w("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,r("next",(()=>ne(e)),[xe(e,"next")]),r("prev",(()=>le(e)),[xe(e,"previous")]),r("select",(()=>oe(e)),[xe(e,"all")]),w("label",null,[this.caseField,xe(e,"match case")]),w("label",null,[this.reField,xe(e,"regexp")]),w("label",null,[this.wordField,xe(e,"by word")]),...e.state.readOnly?[]:[w("br"),this.replaceField,r("replace",(()=>ce(e)),[xe(e,"replace")]),r("replaceAll",(()=>he(e)),[xe(e,"replace all")])],w("button",{name:"close",onclick:()=>ge(e),"aria-label":xe(e,"close"),type:"button"},["Ã—"])])}commit(){let e=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});if(!e.eq(this.query)){this.query=e;this.view.dispatch({effects:X.of(e)})}}keydown(e){if(l(this.view,e,"search-panel"))e.preventDefault();else if(e.keyCode==13&&e.target==this.searchField){e.preventDefault();(e.shiftKey?le:ne)(this.view)}else if(e.keyCode==13&&e.target==this.replaceField){e.preventDefault();ce(this.view)}}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(X)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e;this.searchField.value=e.search;this.replaceField.value=e.replace;this.caseField.checked=e.caseSensitive;this.reField.checked=e.regexp;this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(O).top}}function xe(e,t){return e.state.phrase(t)}const ye=30;const we=/[\s\.,:;?!]/;function Se(e,{from:r,to:i}){let s=e.state.doc.lineAt(r),n=e.state.doc.lineAt(i).to;let l=Math.max(s.from,r-ye),o=Math.min(n,i+ye);let a=e.state.sliceDoc(l,o);if(l!=s.from)for(let e=0;e<ye;e++)if(!we.test(a[e+1])&&we.test(a[e])){a=a.slice(e);break}if(o!=n)for(let e=a.length-1;e>a.length-ye;e--)if(!we.test(a[e-1])&&we.test(a[e])){a=a.slice(0,e);break}return t.announce.of(`${e.state.phrase("current match")}. ${a} ${e.state.phrase("on line")} ${s.number}.`)}const be=t.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}});const Me=[Z,p.low(ie),be];export{RegExpCursor,SearchCursor,SearchQuery,ge as closeSearchPanel,ne as findNext,le as findPrevious,_ as getSearchQuery,L as gotoLine,D as highlightSelectionMatches,pe as openSearchPanel,he as replaceAll,ce as replaceNext,V as search,ve as searchKeymap,ee as searchPanelOpen,oe as selectMatches,T as selectNextOccurrence,ae as selectSelectionMatches,X as setSearchQuery};

